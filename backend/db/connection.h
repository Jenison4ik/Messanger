#pragma once
#include <pqxx/pqxx>

/**
 * @brief Обёртка над соединением PQXX.
 *
 * Класс инкапсулирует создание соединения с PostgreSQL на основе
 * переменных окружения и предоставляет к нему безопасный доступ.
 * Используется как синглтон-подобный объект, который создаётся один раз
 * и передаётся в репозитории.
 */
class Database {
public:
    /**
     * @brief Конструктор создаёт соединение, считывая параметры из ENV.
     *
     * Бросает исключение PQXX, если одно из значений некорректно или
     * подключение не удалось. Логирует факт успешного подключения.
     */
    Database();

    /**
     * @brief Получить ссылку на активное соединение.
     *
     * Возвращает lvalue-ссылку, чтобы избежать копирования и позволить
     * повторное использование одного соединения между транзакциями.
     */
    pqxx::connection& get();

private:
    /// Живое соединение с БД; должно существовать пока жив объект Database.
    pqxx::connection conn;
};
